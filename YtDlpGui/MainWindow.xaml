<Window x:Class="YtDlpGui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:YtDlpGui"
        mc:Ignorable="d"
        Title="yt-dlp GUI by C# WPF" Height="500" Width="800"
        WindowStartupLocation="CenterScreen">

    <!-- 将ViewModel设置为窗口的数据上下文 -->
    <Window.DataContext>
        <local:MainViewModel/>
    </Window.DataContext>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- URL -->
            <RowDefinition Height="Auto"/>
            <!-- Language Switcher - NEW -->
            <RowDefinition Height="Auto"/>
            <!-- Format & Path -->
            <RowDefinition Height="Auto"/>
            <!-- Button -->
            <RowDefinition Height="Auto"/>
            <!-- Progress -->
            <RowDefinition Height="*"/>
            <!-- Log -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Video URL Input -->
        <Label Grid.Row="0" Grid.Column="0" Content="视频链接:" VerticalAlignment="Center"/>
        <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3" VerticalAlignment="Center" Margin="5"
                 Text="{Binding VideoUrl, UpdateSourceTrigger=PropertyChanged}"/>

        <!-- Download Options -->
        <Label Grid.Row="1" Grid.Column="0" Content="下载格式:" VerticalAlignment="Center"/>
        <ComboBox Grid.Row="1" Grid.Column="1" Margin="5"
                  ItemsSource="{Binding DownloadOptions}"
                  DisplayMemberPath="Description"
                  SelectedValuePath="Arguments"
                  SelectedValue="{Binding SelectedFormatArgs}"/>

        <Button Grid.Row="1" Grid.Column="2" Content="选择保存位置" Margin="5" Padding="10,0"
                Command="{Binding BrowseFolderCommand}"/>

        <Button Grid.Row="1" Grid.Column="3" Content="打开目录" Margin="5,5,0,5" Padding="10,0"
        Command="{Binding OpenFolderCommand}"/>

        <!-- Action Button -->
        <Button Grid.Row="2" Margin="0,10,5,10" Padding="0,10" FontWeight="Bold"
                Content="开始下载"
                Command="{Binding DownloadCommand}"
                IsEnabled="{Binding IsNotDownloading}" Grid.ColumnSpan="4"/>

        <!-- Progress Bar -->
        <ProgressBar Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="4" Height="10" Margin="5,5,5,5"
                     Value="{Binding DownloadProgress}"/>
        <TextBlock Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" HorizontalAlignment="Center" VerticalAlignment="Center"
           Text="{Binding DownloadProgress, StringFormat={}{0:0}%}"
           FontWeight="SemiBold" Foreground="White">
            <TextBlock.Effect>
                <DropShadowEffect ShadowDepth="1" Color="Black" Opacity="0.75" BlurRadius="2"/>
            </TextBlock.Effect>
        </TextBlock>


        <!-- Log Output -->
        <TextBox Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="4" Margin="5,5,5,10"
                 x:Name="LogTextBox"
                 Text="{Binding LogOutput, Mode=OneWay}"
                 IsReadOnly="True"
                 VerticalScrollBarVisibility="Auto"
                 FontFamily="Consolas"
                 TextWrapping="Wrap"
                 TextChanged="LogTextBox_TextChanged" Grid.RowSpan="2"/>

    </Grid>
</Window>